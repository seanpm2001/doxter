var Doxter=function(){};Doxter.prototype.init=function(e,t){return this.id=e,this.editor={},this.config=this.configure(t||{}),this},Doxter.prototype.createReferenceTags=function(e,t){for(var o="",r,n=0;n<t.length;n++)o=o+"{"+(r=e.toLowerCase()+":"+t[n].id)+"}";return o},Doxter.prototype.replaceSelection=function(e){this.editor.codemirror.replaceSelection(e),this.editor.codemirror.focus()},Doxter.prototype.createSelectionModal=function(e,t,o){var r=this;Craft.createElementSelectorModal("craft\\elements\\"+e,{multiSelect:!!o,criteria:t||{},onSelect:function(t){var o=r.createReferenceTags(e,t);o&&r.replaceSelection(o)}})},Doxter.prototype.selectEntry=function(){var e=this;return function(){e.createSelectionModal("Entry")}},Doxter.prototype.selectAsset=function(){var e=this;return function(){e.createSelectionModal("Asset")}},Doxter.prototype.selectUser=function(){var e=this;return function(){e.createSelectionModal("User")}},Doxter.prototype.selectTag=function(){var e=this;return function(){e.createSelectionModal("Tag")}},Doxter.prototype.fullScreen=function(e){var t=$("#main-container");$(window).on({keydown:function(e){27===e.keyCode&&t.removeClass("fullscreen")}}),t.toggleClass("fullscreen"),e.toggleFullScreen()},Doxter.prototype.getToolbar=function(e){var t=this;if(!e.showToolbar)return[];var o=[{name:"bold",title:"Bold (Ctrl+B",action:SimpleMDE.toggleBold,className:"fa fa-bold"},{name:"italic",action:SimpleMDE.toggleItalic,className:"fa fa-italic",title:"Italic (Ctrl+I)"},{name:"quote",action:SimpleMDE.toggleBlockquote,className:"fa fa-quote-left",title:"Quote (Ctrl+')"},{name:"ordered-list",action:SimpleMDE.toggleOrderedList,className:"fa fa-list-ol",title:"Numbered List (Ctrl+Alt+L)"},{name:"unordered-list",action:SimpleMDE.toggleUnorderedList,className:"fa fa-list-ul",title:"Generic List (Ctrl+L)"},{name:"link",action:SimpleMDE.drawLink,className:"fa fa-link",title:"Create Link (Ctrl+K)"},{name:"image",action:SimpleMDE.drawImage,className:"fa fa-picture-o",title:"Insert Image (Ctrl+Alt+I)"},{name:"doxter-users",action:t.selectUser(),className:"fa fa-users doxter-primary-icon",title:"User Reference (Ctrl+Alt+1)"},{name:"doxter-entries",action:t.selectEntry(),className:"fa fa-newspaper-o doxter-primary-icon",title:"Entry Reference (Ctrl+Alt+2)"},{name:"doxter-assets",action:t.selectAsset(),className:"fa fa-picture-o doxter-primary-icon",title:"Asset Reference (Ctrl+Alt+3)"},{name:"doxter-tags",action:t.selectTag(),className:"fa fa-tags doxter-primary-icon",title:"Tag Reference (Ctrl+Alt+4)"}];return this.getEnabledToolbarIcons(o,e.enabledToolbarIconNames)},Doxter.prototype.getEnabledToolbarIcons=function(e,t){if(e.length===t.length)return e;for(var o=[],r={},n=0;n<e.length;n++)r=e[n],-1!==t.indexOf(r.name)&&o.push(r);return o},Doxter.prototype.configure=function(e){var t=this;return{element:document.getElementById(t.id),status:!1,toolbarTips:!0,toolbarGuideIcon:!1,autofocus:!1,lineWrapping:!!e.enableLineWrapping,indentWithTabs:!!e.indentWithTabs,tabSize:Number(e.tabSize),forceSync:!0,spellChecker:!!e.enableSpellChecker,toolbar:t.getToolbar(e)}},Doxter.prototype.updateFixedToolbar=function(){let e=document.querySelector("body.fixed-header #header");if(e){let t=e.offsetHeight;const o=document.querySelector(".doxter");o.querySelector(".editor-toolbar").style.top=`${o.scrollTop+t}px`}},Doxter.prototype.updateFixedToolbarLivePreview=function(){console.log("updateFixedToolbarLivePreview");let e=document.querySelector(".lp-editor-container .flex");if(e){let t=e.offsetHeight-parseFloat(window.getComputedStyle(document.querySelector(".lp-editor-container .lp-editor"),null).getPropertyValue("padding-top"));const o=document.querySelector(".lp-editor .doxter");o.querySelector(".editor-toolbar").style.top=`${o.scrollTop+t}px`}},Doxter.prototype.openLivePreviewCallback=function(){const e=document.querySelector(".lp-editor-container .lp-editor");var t=this;e&&(e.addEventListener("scroll",(function(){t.updateFixedToolbarLivePreview()})),e.addEventListener("resize",(function(){t.updateFixedToolbarLivePreview()})))},Doxter.prototype.render=function(){this.editor=new SimpleMDE(this.config);var e=this;Garnish.$win.on("resize",(function(){e.editor.codemirror.refresh()})),window.addEventListener("scroll",(function(){e.updateFixedToolbar()})),window.addEventListener("resize",(function(){e.updateFixedToolbar()})),Garnish.on(Craft.Preview,"open",(function(){e.openLivePreviewCallback()})),Garnish.on(Craft.LivePreview,"enter",(function(){e.openLivePreviewCallback()}))};
//# sourceMappingURL=doxter.js.map